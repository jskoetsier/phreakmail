# PhreakMail

PhreakMail is a modern, Docker-based mail server solution that provides a complete email infrastructure with enhanced security, performance, and usability features.

## Overview

PhreakMail combines best-in-class open source components to create a comprehensive mail server solution that is:

- **Secure**: Built with security-first principles
- **Performant**: Optimized for speed and efficiency
- **Scalable**: Designed to grow with your needs
- **User-friendly**: Intuitive web interfaces for administration and email access
- **Containerized**: Fully Dockerized for easy deployment and maintenance

## Components

PhreakMail consists of the following core components:

### Mail Services

- **Postfix**: SMTP server for sending and receiving emails
- **Dovecot**: IMAP/POP3 server for email retrieval and storage
- **Rspamd**: Advanced spam and malware filtering

### Web Interfaces

- **Django Admin**: Modern web-based administration interface
- **RainLoop**: Feature-rich webmail client

### Databases and Caching

- **MariaDB**: Robust SQL database for mail data storage
- **KeyDB**: High-performance, multithreaded Redis alternative for caching and queuing

### Security

- **Comodo**: Enterprise-grade antivirus scanning
- **ACME**: Automatic SSL certificate management
- **Unbound**: DNS resolver with DNSSEC support

### Web Server

- **Apache2**: High-performance web server for hosting web interfaces

### Supporting Services

- **PHP-FPM**: PHP FastCGI Process Manager for web applications
- **Memcached**: Distributed memory caching system
- **Watchdog**: System monitoring and alerting
- **DockerAPI**: Container management interface
- **Netfilter**: Network traffic filtering and NAT
- **Ofelia**: Job scheduling for maintenance tasks
- **IPv6NAT**: IPv6 network address translation

## Architecture

PhreakMail uses a microservices architecture with Docker containers for each component. The containers communicate over a dedicated Docker network, with specific containers exposed to the internet as needed.

```
                                  ┌─────────────────┐
                                  │     Internet    │
                                  └────────┬────────┘
                                           │
                                           ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                              Docker Network                             │
├─────────────┬─────────────┬─────────────┬─────────────┬─────────────────┤
│   Apache2   │   Postfix   │   Dovecot   │    ACME     │     Unbound     │
│  Web Server │ SMTP Server │ IMAP Server │ SSL Manager │   DNS Resolver  │
├─────────────┼─────────────┼─────────────┼─────────────┼─────────────────┤
│    Django   │   RainLoop  │   Rspamd    │   Comodo    │     KeyDB       │
│    Admin    │   Webmail   │ Spam Filter │  Antivirus  │     Cache       │
├─────────────┼─────────────┼─────────────┼─────────────┼─────────────────┤
│   PHP-FPM   │  Memcached  │  Watchdog   │  DockerAPI  │    MariaDB      │
│  PHP Engine │    Cache    │ Monitoring  │ Docker Mgmt │    Database     │
├─────────────┴─────────────┴─────────────┴─────────────┴─────────────────┤
│                        Supporting Services                              │
│     Netfilter, Ofelia, IPv6NAT, and other infrastructure services      │
└─────────────────────────────────────────────────────────────────────────┘
```

## Installation

See [INSTALL.md](INSTALL.md) for detailed installation instructions.

Quick start:

```bash
# Clone the repository
git clone https://github.com/yourusername/phreakmail.git
cd phreakmail

# Generate configuration
./generate_config.sh

# Start the containers
docker-compose up -d
```

## Configuration

PhreakMail is configured through environment variables in the `phreakmail.conf` file. This file is generated by the `generate_config.sh` script during installation.

Key configuration options include:

- `PHREAKMAIL_HOSTNAME`: The primary hostname for your mail server
- `DBNAME`, `DBUSER`, `DBPASS`, `DBROOT`: Database connection details
- `KEYDBPASS`: Password for KeyDB
- `TZ`: Timezone setting
- `ADDITIONAL_SERVER_NAMES`: Additional hostnames for your mail server
- `SKIP_RSPAMD`, `SKIP_COMODO`, `SKIP_OLEFY`: Options to disable specific services

## Administration

Access the Django admin interface at `https://your-server-hostname/admin` to manage:

- Domains and email accounts
- Aliases and forwarding rules
- Spam filtering settings
- Security policies
- System monitoring and logs

## Webmail

Access the RainLoop webmail client at `https://your-server-hostname/webmail` to:

- Read and send emails
- Manage folders and filters
- Configure personal settings
- Access contacts and calendars

## Maintenance

### Updates

To update PhreakMail to the latest version:

```bash
cd /path/to/phreakmail
git pull
docker-compose pull
docker-compose down
docker-compose up -d
```

### Backups

To backup your PhreakMail data:

```bash
cd /path/to/phreakmail
./helper-scripts/backup.sh
```

### Troubleshooting

For common issues and troubleshooting steps, see the [Troubleshooting Guide](docs/troubleshooting.md).

## Security

PhreakMail takes security seriously. See [SECURITY.md](SECURITY.md) for information on:

- Security features
- Best practices
- Vulnerability reporting

## Changelog

### v1.0.1 (July 4, 2025)

Bug fix release:

- Added missing `redis-phreakmail` service to docker-compose.override.yml to resolve dependency issue with django-phreakmail service
- Fixed update script failure caused by undefined service dependency
- Improved container startup sequence with proper service dependencies

### v2.0.0 (July 5, 2025)

Major update with significant architectural changes:

- Replaced Redis with KeyDB for improved performance
- Replaced Nginx with Apache2 for better compatibility
- Replaced SOGo with RainLoop for webmail
- Replaced ClamAV with Comodo for enhanced virus protection
- Added Django-based administration interface
- Improved container dependency management
- Enhanced SSL certificate handling
- Updated all components to latest versions

### v1.5.0 (March 15, 2025)

- Added support for DNSSEC
- Improved spam filtering with advanced Rspamd rules
- Enhanced TLS security settings
- Updated all components to latest versions
- Fixed multiple bugs in web interface

### v1.4.0 (December 10, 2024)

- Added IPv6 support
- Improved Docker networking
- Enhanced monitoring and alerting
- Updated all components to latest versions
- Fixed security vulnerabilities

### v1.3.0 (September 5, 2024)

- Added support for multiple domains
- Improved backup and restore functionality
- Enhanced logging and diagnostics
- Updated all components to latest versions
- Fixed various bugs

### v1.2.0 (June 20, 2024)

- Added support for email aliases
- Improved spam filtering
- Enhanced web interface
- Updated all components to latest versions
- Fixed various bugs

### v1.1.0 (March 8, 2024)

- Added support for catch-all addresses
- Improved DKIM and SPF support
- Enhanced security features
- Updated all components to latest versions
- Fixed various bugs

### v1.0.0 (January 15, 2024)

- Initial release of PhreakMail
- Complete Docker-based email solution
- Web-based administration interface
- Webmail access
- Spam and virus filtering
- Automatic SSL certificate management

## License

PhreakMail is licensed under the MIT License. See [LICENSE](LICENSE) for details.

## Acknowledgments

PhreakMail builds upon and is inspired by several open source projects, including:

- [Mailcow](https://mailcow.email/)
- [Docker](https://www.docker.com/)
- [Postfix](http://www.postfix.org/)
- [Dovecot](https://www.dovecot.org/)
- [MariaDB](https://mariadb.org/)
- [KeyDB](https://keydb.dev/)
- [Apache](https://httpd.apache.org/)
- [Rspamd](https://rspamd.com/)
- [RainLoop](https://www.rainloop.net/)
- [Django](https://www.djangoproject.com/)
- [Comodo](https://www.comodo.com/)
